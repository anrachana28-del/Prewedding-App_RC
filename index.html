<!DOCTYPE html>
<html lang="km">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>ğŸ’– Pink Wedding App</title>
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="pink">
<link rel="apple-touch-icon" href="icons/icon-192.png">

<style>
body {margin:0; font-family:-apple-system,Khmer OS Battambang,"Segoe UI",Roboto,Oxygen,Ubuntu,sans-serif; background: linear-gradient(135deg,#ffe6f0,#fff5fa); overflow-x:hidden; display:flex; flex-direction:column; height:100vh; position:relative;}
.heart { position:absolute; width:18px; height:18px; background:pink; transform:rotate(45deg); border-radius:2px; opacity:0.7; animation: floatUp 10s linear infinite; }
.heart::before, .heart::after { content:""; position:absolute; width:18px; height:18px; background:pink; border-radius:50%; }
.heart::before { top:-9px; left:0; }
.heart::after { left:-9px; top:0; }
@keyframes floatUp { 0% { transform:translateY(100vh) scale(0.5) rotate(45deg); opacity:0; } 30% { opacity:1; } 100% { transform:translateY(-10vh) scale(1.2) rotate(45deg); opacity:0; } }

.app-header { position: fixed; top:0; left:0; width:100%; background:#ff4da6; color:white; padding:15px; text-align:center; font-size:20px; font-weight:bold; box-shadow:0 2px 5px rgba(0,0,0,0.1); border-bottom-left-radius:15px; border-bottom-right-radius:15px; z-index:1000; }
.app-container { flex:1; padding:20px; padding-top:70px; overflow-y:auto; z-index:2; }

.card { background:white; border-radius:20px; box-shadow:0 5px 15px rgba(0,0,0,0.1); padding:20px; margin-bottom:20px; transition: transform 0.2s ease; text-align:center; }
.card:hover { transform:translateY(-5px); }
.card h2 { margin:10px 0 5px 0; color:#ff4da6; }
.card p { color:#444; line-height:1.5; }
.card img { width:120px; height:120px; border-radius:50%; object-fit:cover; margin-bottom:10px; border:3px solid #ffb6c1; }

.btn { display:inline-block; padding:12px 20px; background:#ff4da6; color:white; border:none; border-radius:12px; font-size:16px; cursor:pointer; overflow:hidden; position:relative; transition:0.3s;}
.btn:hover { background:#e63e90; }

.bottom-nav { position: fixed; bottom:0; left:0; width:100%; display:flex; justify-content: space-around; background: #fff; padding:12px 0; border-top:1px solid #eee; box-shadow:0 -2px 8px rgba(0,0,0,0.1); z-index:999; }
.nav-btn { text-align:center; font-size:16px; color:#555; cursor:pointer; transition:0.3s; padding:6px 12px; border-radius:12px; position:relative; }
.nav-btn.active { color:#ff4da6; font-weight:bold; text-shadow:0 0 8px rgba(255,77,166,0.7); }
.nav-btn:hover::after { content:"ğŸ’–"; position:absolute; top:-20px; left:50%; transform:translateX(-50%) scale(1); animation: hoverHeart 0.8s ease forwards; }
@keyframes hoverHeart { 0% { opacity:0; transform:translateX(-50%) translateY(0) scale(0.5);} 50% { opacity:1; transform:translateX(-50%) translateY(-10px) scale(1.2);} 100% { opacity:0; transform:translateX(-50%) translateY(-20px) scale(1);} }

#installBtn { position:fixed; bottom:100px; right:20px; z-index:1000; display:none; }
#iosInstruction { display:none; position:fixed; bottom:150px; left:10px; right:10px; background:rgba(255,77,166,0.95); color:white; padding:12px 15px; border-radius:12px; text-align:center; font-size:14px; z-index:1001; box-shadow:0 2px 5px rgba(0,0,0,0.2); }

.view { display:none; }
.view.active { display:block; }

iframe { width:100%; height:300px; border-radius:15px; border:0; }

#loadingOverlay {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background: linear-gradient(135deg,#ffe6f0,#fff5fa);
  display:flex; justify-content:center; align-items:center;
  z-index:2000;
  overflow:hidden;
}
.spinner {
  width:60px; height:60px; border:6px solid #f3f3f3; border-top:6px solid #ff4da6;
  border-radius:50%; animation: spin 1s linear infinite;
}
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

.floating-heart {
  position:absolute; width:20px; height:20px; background:pink; transform:rotate(45deg);
  border-radius:2px; opacity:0.8; animation: floatUp 3s linear forwards;
}
.floating-heart::before,.floating-heart::after { content:""; position:absolute; width:20px; height:20px; background:pink; border-radius:50%; }
.floating-heart::before { top:-10px; left:0; }
.floating-heart::after { left:-10px; top:0; }
@keyframes floatUp {
  0% { transform:translateY(0) scale(0.5) rotate(45deg); opacity:0; }
  30% { opacity:1; }
  100% { transform:translateY(-150px) scale(1.2) rotate(45deg); opacity:0; }
}

/* Animated dots */
.dots::after {
  content: '.';
  animation: dotsAnim 1s steps(3, end) infinite;
}
@keyframes dotsAnim {
  0%,20% { content: ''; }
  40% { content: '.'; }
  60% { content: '..'; }
  80%,100% { content: '...'; }
}
</style>
</head>
<body>

<div id="loadingOverlay">
  <div style="text-align:center; position:relative;">
    <div class="spinner"></div>
    <div id="loadingText" style="margin-top:20px; font-size:16px; color:#ff4da6; font-weight:bold;">
      áŠáŸ†áá¾ášá€á¶áš<span class="dots">...</span>
    </div>
    <div id="floatingHearts"></div>
  </div>
</div>

<div class="app-header">ğŸ’– Pink Wedding App</div>

<div class="app-container">
  <div id="getstart" class="view active">
    <div class="card">
      <h2>áŸá¼á˜áŸáŸ’áœá¶á‚á˜á“áŸ!</h2>
      <p>á…á»á… "Get Started" áŠá¾á˜áŸ’á”á¸á‘á¶á‰á™á€ App á“á·á„á”á¾á€ PWA version á“áŸ…á›á¾ Home Screen</p>
      <button class="btn" id="getStartBtn">Get Started ğŸ’–</button>
    </div>
  </div>

  <div id="home" class="view">
    <div class="card">
      <h2>áŸá¼á˜áŸáŸ’áœá¶á‚á˜á“áŸ!</h2>
      <p>á“áŸáŸ‡á‡á¶á‚áŸ†ášá¼ App UI PWA style iOS + AndroidáŸ” á…á»á…ğŸ’– á“áŸ…á›á¾ screen áŠá¾á˜áŸ’á”á¸á”á“áŸ’ááŸ‚á˜ hearts effectáŸ”</p>
      <button class="btn">á…á¶á”áŸ‹á•áŸ’áá¾á˜</button>
    </div>
  </div>

  <div id="map" class="view">
    <h2 style="text-align:center; color:#c71585;">á‘á¸áá¶áŸ†á„á–á·á’á¸á˜á„áŸ’á‚á›á€á¶áš</h2>
    <iframe src="https://www.google.com/maps/embed?pb=!1m17!1m12!1m3!1d3905.5730312067944!2d105.375636!3d11.795083999999997!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m2!1m1!2zMTHCsDQ3JzQyLjMiTiAxMDXCsDIyJzMyLjMiRQ!5e0!3m2!1sen!2skh!4v1755935216345!5m2!1sen!2skh" allowfullscreen="" loading="lazy"></iframe>
    <div style="text-align:center; margin-top:10px;">
      <button class="btn" onclick="copyMapLink()">ğŸ“‹ Copy Link</button>
      <button class="btn" onclick="shareMapLink()">ğŸ”— Share Link</button>
    </div>
    <div class="card">
      <p>á—á¼á˜á· á–áŸ’ášáŸƒá›á¶á“ áƒá»áŸ† ášáŸ†á›áŸá… áŸáŸ’ášá»á€ áŸáŸ’ášá»á€áŸáŸŠá¸á’ášá€ááŸ’áá¶á› ááŸááŸ’áá–áŸ’ášáŸƒáœáŸ‚á„</p>
    </div>
  </div>

  <div id="son" class="view">
    <div class="card">
      <img src="https://via.placeholder.com/120?text=Son1" alt="á€á¼á“á”áŸ’ášá»áŸ áŸ¡">
      <h2>á€á¼á“á”áŸ’ášá»áŸ </h2>
      <p>á›áŸáá‘á¼ášáŸáŸá–áŸ’á’</p>
    </div>
    <div class="card">
      <img src="https://via.placeholder.com/120?text=Daughter1" alt="á€á¼á“áŸáŸ’ášá¸ áŸ¡">
      <h2>á€á¼á“áŸáŸ’ášá¸ </h2>
      <p>á›áŸáá‘á¼ášáŸáŸá–áŸ’á’</p>
    </div>
  </div>
</div>

<div class="bottom-nav" id="bottomNav">
  <div class="nav-btn active" onclick="showPage('home', this)">ğŸ  Home</div>
  <div class="nav-btn" onclick="showPage('map', this)">ğŸ—ºï¸ Map</div>
  <div class="nav-btn" onclick="showPage('son', this)">á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„</div>
</div>

<button id="installBtn" class="btn">ğŸ“² Install App</button>
<div id="iosInstruction">ğŸ“± á…á»á… Share â†’ Add to Home Screen áŠá¾á˜áŸ’á”á¸áŠáŸ†á¡á¾á„ App</div>

<script>
// ---------- Helpers ----------
let deferredPrompt;
const installBtn = document.getElementById("installBtn");
function isPWAInstalled(){ return window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true; }
function isIOS(){ return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream; }

// ---------- Loading overlay ----------
window.addEventListener("DOMContentLoaded", ()=>{
  const overlay = document.getElementById("loadingOverlay");
  const floatingContainer = document.getElementById("floatingHearts");

  // Auto hide after 5s
  setTimeout(()=>{
    overlay.style.transition="opacity 0.5s ease";
    overlay.style.opacity=0;
    setTimeout(()=>overlay.style.display="none",500);
  },5000);

  // Floating hearts animation
  const floatInterval = setInterval(()=>{
    const h = document.createElement("div");
    h.className="floating-heart";
    h.style.left=Math.random()*100+"%";
    h.style.animationDuration=(2+Math.random()*2)+"s";
    floatingContainer.appendChild(h);
    setTimeout(()=>h.remove(),4000);
  },300);
});

// ---------- Page load ----------
window.addEventListener("DOMContentLoaded", ()=>{
  document.getElementById("bottomNav").style.display="none";
  document.querySelectorAll(".view").forEach(v=>v.classList.remove("active"));
  document.getElementById("getstart").classList.add("active");

  if(!isPWAInstalled()){ installBtn.style.display = "block"; } 
  else { installBtn.style.display = "none"; }

  if(isIOS() && !isPWAInstalled()){
    const iosBanner = document.getElementById("iosInstruction");
    iosBanner.style.display = "block";
    setTimeout(()=>iosBanner.style.display="none",7000);
  }

  // Floating hearts
  for(let i=0;i<20;i++){ let heart=document.createElement("div"); heart.className="heart"; heart.style.left=Math.random()*100+"vw"; heart.style.animationDuration=(5+Math.random()*7)+"s"; document.body.appendChild(heart);}
  document.body.addEventListener("click", function(e){ const heart=document.createElement("div"); heart.className="heart"; heart.style.left=e.clientX-9+"px"; heart.style.top=e.clientY-9+"px"; heart.style.animationDuration="1s"; heart.style.opacity=1; document.body.appendChild(heart); setTimeout(()=>heart.remove(),1000); });
});

// ---------- PWA install ----------
window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; });

document.getElementById("getStartBtn").addEventListener("click", async ()=>{
  document.getElementById("bottomNav").style.display="flex";
  showPage('home');
  if(deferredPrompt){
    deferredPrompt.prompt();
    await deferredPrompt.userChoice;
    deferredPrompt = null;
    installBtn.style.display="none";
  }
});

installBtn.addEventListener("click", async () => {
  if(deferredPrompt){
    deferredPrompt.prompt();
    await deferredPrompt.userChoice;
    deferredPrompt = null;
    installBtn.style.display="none";
  } else if(isIOS()){
    alert("ğŸ“± á…á»á… Share â†’ Add to Home Screen áŠá¾á˜áŸ’á”á¸áŠáŸ†á¡á¾á„ App");
  }
});

// ---------- Navigation ----------
function showPage(pageId, btn){
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.getElementById(pageId).classList.add('active');
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');
}

// ---------- Map ----------
const mapURL = "https://maps.app.goo.gl/4zCB3UtRHt4m7sj69";
function copyMapLink() { navigator.clipboard.writeText(mapURL).then(()=>alert("Map link copied!")); }
function shareMapLink() { if(navigator.share){ navigator.share({title:"Wedding Map", text:"Check wedding location", url:mapURL}); } else { alert("Browser does not support native share."); } }

// ---------- Service Worker ----------
if('serviceWorker' in navigator){ navigator.serviceWorker.register('./sw.js').then(()=>console.log("SW registered")); }
</script>
</body>
</html>
